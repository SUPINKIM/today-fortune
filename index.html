<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë„íŒŒë¯¼ ì¹´ë“œ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      -webkit-font-smoothing: antialiased;
    }

    .app {
      position: relative;
      width: 100%;
      height: 100%;
      max-width: 520px;
      margin: 0 auto;
      background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    /* ìƒë‹¨ UI */
    .top-bar {
      position: absolute;
      top: calc(12px + env(safe-area-inset-top, 0px));
      left: 0;
      right: 0;
      padding: 0 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      z-index: 10;
    }

    .title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 20px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }

    .subtitle {
      font-size: 13px;
      color: #94a3b8;
      text-align: center;
    }

    .stats {
      display: flex;
      gap: 8px;
      font-size: 11px;
      margin-top: 4px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.4);
      backdrop-filter: blur(8px);
    }

    .chip-rare {
      border-color: rgba(250, 204, 21, 0.6);
      color: #facc15;
    }

    .chip-epic {
      border-color: rgba(192, 132, 252, 0.6);
      color: #c084fc;
    }

    /* ì¹´ë“œ ìŠ¤í”„ë ˆë“œ ì˜ì—­ */
    .card-spread {
      position: relative;
      width: 100%;
      height: 350px;
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
    }

    /* ê°œë³„ ì¹´ë“œ */
    .card {
      position: absolute;
      width: 100px;
      height: 140px;
      cursor: pointer;
      transform-style: preserve-3d;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      -webkit-tap-highlight-color: transparent;
      transform-origin: center center;
    }

    .card:hover:not(.selected):not(.hidden) {
      transform: var(--hover-transform);
      z-index: 50 !important;
    }

    .card.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.5) translateY(100px) !important;
    }

    .card.selected {
      z-index: 100 !important;
      transform: translateX(0) translateY(0) rotate(0deg) scale(1.8) !important;
    }

    .card.selected.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 
        0 8px 30px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      overflow: hidden;
    }

    /* ì¹´ë“œ ë’·ë©´ */
    .card-back {
      background: linear-gradient(145deg, #312e81 0%, #1e1b4b 100%);
      border: 1.5px solid rgba(129, 140, 248, 0.3);
    }

    .card-back::before {
      content: "";
      position: absolute;
      inset: 6px;
      border: 1px solid rgba(129, 140, 248, 0.2);
      border-radius: 6px;
    }

    .card-back-symbol {
      font-size: 28px;
      color: rgba(165, 180, 252, 0.5);
    }

    .card-back-pattern {
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 30% 30%, rgba(129, 140, 248, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(167, 139, 250, 0.1) 0%, transparent 50%);
    }

    /* ì¹´ë“œ ì•ë©´ */
    .card-front {
      transform: rotateY(180deg);
      padding: 14px 10px;
      text-align: center;
    }

    .card-front.common {
      background: linear-gradient(145deg, #f8fafc 0%, #e2e8f0 100%);
      border: 1.5px solid rgba(148, 163, 184, 0.4);
    }

    .card-front.rare {
      background: linear-gradient(145deg, #fef9c3 0%, #fde047 100%);
      border: 1.5px solid rgba(202, 138, 4, 0.5);
      box-shadow: 
        0 8px 30px rgba(0, 0, 0, 0.4),
        0 0 25px rgba(250, 204, 21, 0.2);
    }

    .card-front.epic {
      background: linear-gradient(145deg, #f3e8ff 0%, #d8b4fe 100%);
      border: 1.5px solid rgba(147, 51, 234, 0.5);
      box-shadow: 
        0 8px 30px rgba(0, 0, 0, 0.4),
        0 0 30px rgba(192, 132, 252, 0.25);
    }

    .card-emoji {
      font-size: 36px;
      margin-bottom: 8px;
    }

    .card-text {
      font-size: 9px;
      line-height: 1.4;
      color: #1e293b;
      font-weight: 500;
      word-break: keep-all;
    }

    .card-rarity {
      position: absolute;
      bottom: 8px;
      font-size: 7px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 2px 6px;
      border-radius: 999px;
    }

    .card-rarity.common {
      background: rgba(100, 116, 139, 0.2);
      color: #64748b;
    }

    .card-rarity.rare {
      background: rgba(202, 138, 4, 0.2);
      color: #a16207;
    }

    .card-rarity.epic {
      background: rgba(147, 51, 234, 0.2);
      color: #7e22ce;
    }

    /* íŒíŠ¸ & ë²„íŠ¼ ì˜ì—­ */
    .bottom-area {
      position: absolute;
      bottom: calc(24px + env(safe-area-inset-bottom, 0px));
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      z-index: 10;
    }

    .hint {
      font-size: 13px;
      color: #64748b;
      text-align: center;
      transition: opacity 0.3s;
    }

    .hint.hidden {
      opacity: 0;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
    }

    .btn-group.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, #6366f1, #4f46e5);
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .btn-share {
      background: linear-gradient(135deg, #f97316, #ec4899, #8b5cf6);
      color: white;
      box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
    }

    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: rgba(15, 23, 42, 0.95);
      color: white;
      padding: 14px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      max-width: 90%;
      text-align: center;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.8; }
    }

    .card:not(.selected):not(.hidden) .card-back-symbol {
      animation: pulse 2s ease-in-out infinite;
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 400px) {
      .card {
        width: 70px;
        height: 100px;
      }
      .card.selected {
        transform: translateX(0) translateY(0) rotate(0deg) scale(2.2) !important;
      }
      .card-emoji {
        font-size: 28px;
      }
      .card-text {
        font-size: 7px;
      }
      .card-back-symbol {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="top-bar">
      <div class="title">ğŸƒ ì˜¤ëŠ˜ì˜ ì¹´ë“œ</div>
      <div class="subtitle">ì¹´ë“œë¥¼ ê³¨ë¼ ìš´ëª…ì„ í™•ì¸í•˜ì„¸ìš”</div>
      <div class="stats">
        <div class="chip" id="stat-count">ë½‘ì€ ì¹´ë“œ 0ì¥</div>
        <div class="chip chip-rare" id="stat-rare">ë ˆì–´ 0</div>
        <div class="chip chip-epic" id="stat-epic">ì—í”½ 0</div>
      </div>
    </div>

    <div class="card-spread" id="card-spread"></div>

    <div class="bottom-area">
      <div class="hint" id="hint">ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
      <div class="btn-group" id="btn-group">
        <button class="btn btn-primary" id="reset-btn">ğŸ”„ ë‹¤ì‹œ ë½‘ê¸°</button>
        <button class="btn btn-share" id="share-btn">
          <span id="share-btn-text">ğŸ“¤ ê³µìœ í•˜ê¸°</span>
        </button>
      </div>
    </div>

    <div class="toast" id="toast">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
  </div>

  <script>
    const CARD_POOL = [
      { emoji: "ğŸ”¥", text: "ì˜¤ëŠ˜ë„ ëŒ€ì¶© ì‚´ì§€ë§Œ ê¸°ë¶„ë§Œì€ ë©”ì¸ ìºë¦­í„°." },
      { emoji: "â˜•", text: "ì¹´í˜ì¸ì„ ì‹ ì•™ì²˜ëŸ¼ ë¯¿ëŠ” í¸." },
      { emoji: "ğŸ’»", text: "ì½”ë“œ ì§œë‹¤ ë³´ë©´ ë‚´ê°€ ì§œì¸ ëŠë‚Œ." },
      { emoji: "ğŸŒ™", text: "ì§€ê¸ˆ ìë©´ ë‚´ì¼ì´ ì˜¤ê³ , ì•ˆ ìë©´ ë‚´ì¼ì´ ë§í•œë‹¤." },
      { emoji: "ğŸœ", text: "ë¼ë©´ì´ ì•„ë‹ˆë¼ í–‰ë³µì„ ë“ì´ëŠ” ì¤‘ì…ë‹ˆë‹¤." },
      { emoji: "ğŸŒ", text: "ëŠë¦¿ëŠë¦¿í•˜ì§€ë§Œ ë©ˆì¶”ì§„ ì•ŠëŠ”ë‹¤â€¦ ì•„ë§ˆë„." },
      { emoji: "ğŸ²", text: "ê³„íš? ê·¸ê±° ì¸ìƒì´ë‘ ì•ˆ ì¹œí•´ì„œìš”." },
      { emoji: "ğŸ’¸", text: "ëˆì€ ë– ë‚˜ë„ íƒë°°ëŠ” ì˜¨ë‹¤." },
      { emoji: "ğŸˆ", text: "ì§‘ì‚¬ë„ ì¶œê·¼í•˜ë‹ˆê¹Œ, ê³ ì–‘ì´ë„ í‡´ê·¼ì‹œì¼œì¤˜ì•¼ í•¨." },
      { emoji: "âš¡", text: "ì˜¤ëŠ˜ë„ ì•ˆ í•  ì¼ì„ ì—´ì‹¬íˆ ë¯¸ë£¨ëŠ” ì¤‘." },
      { emoji: "ğŸ§", text: "ë…¸ë˜ í•œ ê³¡ ëë‚  ë•Œê¹Œì§€, ì´ ì¼ë„ ëë‚¬ìœ¼ë©´." },
      { emoji: "ğŸŒˆ", text: "ë³„ì¼ì€ ì—†ì§€ë§Œ, ë³„ ìƒê°ì€ ë§ë‹¤." },
      { emoji: "ğŸ§ ", text: "ë¨¸ë¦¬ëŠ” ì•„ëŠ”ë° ëª¸ì´ ëª¨ë¥´ëŠ” ìƒíƒœ." },
      { emoji: "ğŸš€", text: "ë§ˆìŒë§Œì€ ì´ë¯¸ í‡´ê·¼ í›„." },
      { emoji: "ğŸ§ƒ", text: "ì‚¬ë¼ì§„ ê±´ ì²´ë ¥ì¸ë°, ëŠ˜ì–´ë‚œ ê±´ í”¼ë¡œë„ë¿." },
      { emoji: "ğŸ¯", text: "ëª©í‘œëŠ” ìˆëŠ”ë° ì¡°ì¤€ì´ ì•ˆ ë¨." },
      { emoji: "ğŸŒŠ", text: "íŒŒë„ì²˜ëŸ¼ ì¶œê·¼í•˜ê³  ì°ë¬¼ì²˜ëŸ¼ í‡´ê·¼í•œë‹¤." },
      { emoji: "ğŸ•", text: "ì¸ìƒì€ í”¼ìì²˜ëŸ¼, ì–´ë–¤ ì¡°ê°ì´ë“  ë§›ìˆë‹¤." },
      { emoji: "ğŸ¦¥", text: "ëŠë¦¼ì˜ ë¯¸í•™ì„ ì‹¤ì²œ ì¤‘." },
      { emoji: "âœ¨", text: "ë°˜ì§ë°˜ì§ ë¹›ë‚˜ê³  ì‹¶ì€ë° ë°°í„°ë¦¬ê°€ ì—†ìŒ." },
      { emoji: "ğŸª", text: "ë§¤ì¼ì´ ì„œì»¤ìŠ¤, ë‚˜ëŠ” ê´‘ëŒ€." },
      { emoji: "ğŸŒ»", text: "í•´ë°”ë¼ê¸°ì²˜ëŸ¼ ëˆ ìª½ì„ ë°”ë¼ë³´ëŠ” ì¤‘." },
      { emoji: "ğŸµ", text: "ì¸ìƒì˜ BGMì´ ë²„í¼ë§ ì¤‘." },
      { emoji: "ğŸ”®", text: "ë¯¸ë˜ëŠ” ëª¨ë¥´ì§€ë§Œ í‡´ê·¼ ì‹œê°„ì€ ì•ˆë‹¤." },
      { emoji: "ğŸ§Š", text: "ì¿¨í•œ ì²™í•˜ì§€ë§Œ ì†ì€ ì–¼ìŒì²˜ëŸ¼ ì°¨ê°‘ê²Œ ì‹ëŠ” ì¤‘." },
    ];

    let totalCards = 0;
    let rareCount = 0;
    let epicCount = 0;

    const cardSpread = document.getElementById("card-spread");
    const hint = document.getElementById("hint");
    const btnGroup = document.getElementById("btn-group");
    const resetBtn = document.getElementById("reset-btn");
    const shareBtn = document.getElementById("share-btn");
    const shareBtnText = document.getElementById("share-btn-text");
    const toast = document.getElementById("toast");
    const statCountEl = document.getElementById("stat-count");
    const statRareEl = document.getElementById("stat-rare");
    const statEpicEl = document.getElementById("stat-epic");

    let cards = [];
    let selectedCard = null;
    let isFlipped = false;

    // Web Share API ì§€ì› ì—¬ë¶€ ì²´í¬
    const canShare = navigator.share && navigator.canShare;
    
    if (canShare) {
      shareBtnText.textContent = "ğŸ“¤ ê³µìœ í•˜ê¸°";
    } else {
      shareBtnText.textContent = "ğŸ“¸ ì €ì¥í•˜ê¸°";
    }

    function updateStats() {
      statCountEl.textContent = `ë½‘ì€ ì¹´ë“œ ${totalCards}ì¥`;
      statRareEl.textContent = `ë ˆì–´ ${rareCount}`;
      statEpicEl.textContent = `ì—í”½ ${epicCount}`;
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2500);
    }

    function pickRandomCard() {
      const base = CARD_POOL[Math.floor(Math.random() * CARD_POOL.length)];
      const roll = Math.random();
      let rarity = "common";
      if (roll > 0.985) rarity = "epic";
      else if (roll > 0.8) rarity = "rare";
      return { ...base, rarity };
    }

    function createCards() {
      cardSpread.innerHTML = "";
      cards = [];
      selectedCard = null;
      isFlipped = false;

      const cardCount = 12;
      const spreadAngle = 120;
      const startAngle = -spreadAngle / 2;
      const angleStep = spreadAngle / (cardCount - 1);

      for (let i = 0; i < cardCount; i++) {
        const cardData = pickRandomCard();
        const angle = startAngle + angleStep * i;
        const radians = (angle * Math.PI) / 180;
        
        const radius = 220;
        const x = Math.sin(radians) * radius;
        const y = Math.cos(radians) * radius * 0.3;
        
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.index = i;
        
        const baseTransform = `translateX(${x}px) translateY(${y}px) rotate(${angle}deg)`;
        const hoverTransform = `translateX(${x}px) translateY(${y - 25}px) rotate(${angle}deg) scale(1.12)`;
        
        card.style.setProperty("--hover-transform", hoverTransform);
        card.style.transform = baseTransform;
        card.style.zIndex = i;

        const symbols = ["âœ¦", "â—†", "â˜…", "â–", "âœ§", "â—‡"];
        const symbol = symbols[i % symbols.length];

        card.innerHTML = `
          <div class="card-inner">
            <div class="card-face card-back">
              <div class="card-back-pattern"></div>
              <div class="card-back-symbol">${symbol}</div>
            </div>
            <div class="card-face card-front ${cardData.rarity}">
              <div class="card-emoji">${cardData.emoji}</div>
              <div class="card-text">${cardData.text}</div>
              <div class="card-rarity ${cardData.rarity}">
                ${cardData.rarity === "epic" ? "âœ¨ EPIC" : cardData.rarity === "rare" ? "â­ RARE" : "COMMON"}
              </div>
            </div>
          </div>
        `;

        card.cardData = cardData;
        card.addEventListener("click", () => handleCardClick(card));
        
        cardSpread.appendChild(card);
        cards.push(card);
      }

      hint.classList.remove("hidden");
      hint.textContent = "ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”";
      btnGroup.classList.remove("visible");
    }

    function handleCardClick(card) {
      if (selectedCard === card) {
        if (!isFlipped) {
          card.classList.add("flipped");
          isFlipped = true;
          hint.textContent = "íƒ­í•˜ë©´ ë‹¤ì‹œ ë®ì–´ìš”";
          
          totalCards++;
          if (card.cardData.rarity === "rare") rareCount++;
          if (card.cardData.rarity === "epic") epicCount++;
          updateStats();
          
          btnGroup.classList.add("visible");
        } else {
          card.classList.remove("flipped");
          isFlipped = false;
          hint.textContent = "íƒ­í•´ì„œ ì¹´ë“œ í™•ì¸";
        }
        return;
      }

      if (selectedCard) {
        selectedCard.classList.remove("selected", "flipped");
        cards.forEach(c => c.classList.remove("hidden"));
      }

      selectedCard = card;
      isFlipped = false;

      card.classList.add("selected");
      
      cards.forEach(c => {
        if (c !== card) {
          c.classList.add("hidden");
        }
      });

      hint.textContent = "íƒ­í•´ì„œ ì¹´ë“œ í™•ì¸";
      btnGroup.classList.remove("visible");
    }

    function resetCards() {
      createCards();
    }

    // ì´ëª¨ì§€ë¥¼ Twemoji ì´ë¯¸ì§€ URLë¡œ ë³€í™˜
    function getEmojiImageUrl(emoji) {
      const codePoints = [...emoji]
        .map(char => char.codePointAt(0).toString(16))
        .join("-");
      return `https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/${codePoints}.png`;
    }

    // ì´ë¯¸ì§€ ë¡œë“œ Promise
    function loadImage(url) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => resolve(img);
        img.onerror = () => reject(new Error(`Failed to load: ${url}`));
        img.src = url;
      });
    }

    // Canvasë¡œ ê³µìœ  ì´ë¯¸ì§€ ìƒì„± (ë¹„ë™ê¸°)
    async function createShareCanvas() {
      const { emoji, text, rarity } = selectedCard.cardData;
      
      const canvas = document.createElement("canvas");
      canvas.width = 1080;
      canvas.height = 1920;
      const ctx = canvas.getContext("2d");

      // ë°°ê²½ ê·¸ë¼ë°ì´ì…˜
      const bgGrad = ctx.createLinearGradient(0, 0, 0, 1920);
      bgGrad.addColorStop(0, "#1e1b4b");
      bgGrad.addColorStop(0.5, "#020617");
      bgGrad.addColorStop(1, "#0f172a");
      ctx.fillStyle = bgGrad;
      ctx.fillRect(0, 0, 1080, 1920);

      // íƒ€ì´í‹€ (ì´ëª¨ì§€ ë¶€ë¶„ì€ ì´ë¯¸ì§€ë¡œ)
      ctx.font = "bold 56px system-ui, -apple-system, sans-serif";
      ctx.fillStyle = "rgba(165, 180, 252, 0.9)";
      ctx.textAlign = "center";
      
      // íƒ€ì´í‹€ ì´ëª¨ì§€ ë¡œë“œ
      try {
        const titleEmojiImg = await loadImage(getEmojiImageUrl("ğŸƒ"));
        ctx.drawImage(titleEmojiImg, 540 - 160, 100, 56, 56);
        ctx.fillText(" ì˜¤ëŠ˜ì˜ ì¹´ë“œ", 540 + 20, 150);
      } catch (e) {
        ctx.fillText("ğŸƒ ì˜¤ëŠ˜ì˜ ì¹´ë“œ", 540, 150);
      }

      // ì¹´ë“œ ë°°ê²½
      const cardX = 240;
      const cardY = 400;
      const cardW = 600;
      const cardH = 840;
      const cardR = 40;

      // ì¹´ë“œ ê·¸ë¦¼ì
      ctx.shadowColor = "rgba(0, 0, 0, 0.5)";
      ctx.shadowBlur = 60;
      ctx.shadowOffsetY = 20;

      // ì¹´ë“œ ë°°ê²½ìƒ‰
      let cardGrad;
      if (rarity === "epic") {
        cardGrad = ctx.createLinearGradient(cardX, cardY, cardX + cardW, cardY + cardH);
        cardGrad.addColorStop(0, "#f3e8ff");
        cardGrad.addColorStop(1, "#d8b4fe");
      } else if (rarity === "rare") {
        cardGrad = ctx.createLinearGradient(cardX, cardY, cardX + cardW, cardY + cardH);
        cardGrad.addColorStop(0, "#fef9c3");
        cardGrad.addColorStop(1, "#fde047");
      } else {
        cardGrad = ctx.createLinearGradient(cardX, cardY, cardX + cardW, cardY + cardH);
        cardGrad.addColorStop(0, "#f8fafc");
        cardGrad.addColorStop(1, "#e2e8f0");
      }

      // ë‘¥ê·¼ ì‚¬ê°í˜• ê·¸ë¦¬ê¸°
      ctx.beginPath();
      ctx.moveTo(cardX + cardR, cardY);
      ctx.lineTo(cardX + cardW - cardR, cardY);
      ctx.quadraticCurveTo(cardX + cardW, cardY, cardX + cardW, cardY + cardR);
      ctx.lineTo(cardX + cardW, cardY + cardH - cardR);
      ctx.quadraticCurveTo(cardX + cardW, cardY + cardH, cardX + cardW - cardR, cardY + cardH);
      ctx.lineTo(cardX + cardR, cardY + cardH);
      ctx.quadraticCurveTo(cardX, cardY + cardH, cardX, cardY + cardH - cardR);
      ctx.lineTo(cardX, cardY + cardR);
      ctx.quadraticCurveTo(cardX, cardY, cardX + cardR, cardY);
      ctx.closePath();
      
      ctx.fillStyle = cardGrad;
      ctx.fill();

      // ê·¸ë¦¼ì ë¦¬ì…‹
      ctx.shadowColor = "transparent";
      ctx.shadowBlur = 0;
      ctx.shadowOffsetY = 0;

      // ì¹´ë“œ í…Œë‘ë¦¬
      ctx.strokeStyle = rarity === "epic" 
        ? "rgba(147, 51, 234, 0.5)" 
        : rarity === "rare" 
        ? "rgba(202, 138, 4, 0.5)" 
        : "rgba(148, 163, 184, 0.4)";
      ctx.lineWidth = 4;
      ctx.stroke();

      // ë©”ì¸ ì´ëª¨ì§€ (Twemoji ì´ë¯¸ì§€ë¡œ)
      try {
        const emojiImg = await loadImage(getEmojiImageUrl(emoji));
        const emojiSize = 160;
        ctx.drawImage(emojiImg, 540 - emojiSize/2, 620 - emojiSize/2, emojiSize, emojiSize);
      } catch (e) {
        // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ í…ìŠ¤íŠ¸ë¡œ í´ë°±
        ctx.font = "160px system-ui";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(emoji, 540, 620);
      }

      // í…ìŠ¤íŠ¸
      ctx.font = "bold 44px system-ui, -apple-system, sans-serif";
      ctx.fillStyle = "#1e293b";
      ctx.textBaseline = "top";
      ctx.textAlign = "center";
      
      // í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ
      const maxWidth = 500;
      const lineHeight = 66;
      const words = text.split(" ");
      let line = "";
      let y = 780;
      
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + " ";
        const metrics = ctx.measureText(testLine);
        if (metrics.width > maxWidth && n > 0) {
          ctx.fillText(line.trim(), 540, y);
          line = words[n] + " ";
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      ctx.fillText(line.trim(), 540, y);

      // ë ˆì–´ë¦¬í‹° ë°°ì§€
      let badgeText, badgeEmoji;
      if (rarity === "epic") {
        badgeText = " EPIC";
        badgeEmoji = "âœ¨";
      } else if (rarity === "rare") {
        badgeText = " RARE";
        badgeEmoji = "â­";
      } else {
        badgeText = "COMMON";
        badgeEmoji = null;
      }
      
      ctx.font = "bold 28px system-ui";
      const textWidth = ctx.measureText(badgeText).width;
      const badgeWidth = textWidth + (badgeEmoji ? 80 : 40);
      const badgeX = 540 - badgeWidth / 2;
      const badgeY = 1100;
      
      ctx.fillStyle = rarity === "epic" 
        ? "rgba(147, 51, 234, 0.2)" 
        : rarity === "rare" 
        ? "rgba(202, 138, 4, 0.2)" 
        : "rgba(100, 116, 139, 0.2)";
      
      ctx.beginPath();
      ctx.roundRect(badgeX, badgeY, badgeWidth, 50, 25);
      ctx.fill();
      
      ctx.fillStyle = rarity === "epic" 
        ? "#7e22ce" 
        : rarity === "rare" 
        ? "#a16207" 
        : "#64748b";
      ctx.textBaseline = "middle";

      if (badgeEmoji) {
        try {
          const badgeEmojiImg = await loadImage(getEmojiImageUrl(badgeEmoji));
          ctx.drawImage(badgeEmojiImg, badgeX + 15, badgeY + 9, 32, 32);
          ctx.fillText(badgeText, 540 + 10, badgeY + 25);
        } catch (e) {
          ctx.fillText(badgeEmoji + badgeText, 540, badgeY + 25);
        }
      } else {
        ctx.fillText(badgeText, 540, badgeY + 25);
      }

      // ì›Œí„°ë§ˆí¬
      ctx.font = "32px system-ui";
      ctx.fillStyle = "rgba(148, 163, 184, 0.5)";
      ctx.fillText("@dopamine_card", 540, 1800);

      return canvas;
    }

    // ê³µìœ /ì €ì¥ í•¨ìˆ˜
    async function shareOrSave() {
      if (!selectedCard || !isFlipped) {
        showToast("ë¨¼ì € ì¹´ë“œë¥¼ ë’¤ì§‘ì–´ì£¼ì„¸ìš”!");
        return;
      }

      // ë²„íŠ¼ ë¹„í™œì„±í™” (ë¡œë”© ì¤‘)
      shareBtn.disabled = true;
      shareBtnText.textContent = "â³ ì¤€ë¹„ ì¤‘...";

      try {
        const { emoji, text } = selectedCard.cardData;
        const canvas = await createShareCanvas();

        // Web Share API ì§€ì›í•˜ë©´ ë„¤ì´í‹°ë¸Œ ê³µìœ  ì‹œíŠ¸ ë„ìš°ê¸°
        if (canShare) {
          try {
            const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/png"));
            const file = new File([blob], "dopamine-card.png", { type: "image/png" });
            
            if (navigator.canShare({ files: [file] })) {
              await navigator.share({
                files: [file],
                title: "ì˜¤ëŠ˜ì˜ ë„íŒŒë¯¼ ì¹´ë“œ",
                text: `${emoji} ${text}\n\n#ë„íŒŒë¯¼ì¹´ë“œ #ì˜¤ëŠ˜ì˜ìš´ì„¸`
              });
              showToast("ê³µìœ  ì™„ë£Œ! ğŸ‰");
              return;
            }
          } catch (e) {
            if (e.name !== "AbortError") {
              console.log("Share failed, falling back to download");
            } else {
              return;
            }
          }
        }

        // ê³µìœ  ë¶ˆê°€ëŠ¥í•˜ë©´ ë‹¤ìš´ë¡œë“œ
        const link = document.createElement("a");
        link.download = `dopamine-card-${Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        showToast("âœ… ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        
      } catch (error) {
        console.error(error);
        showToast("ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆì–´ìš” ğŸ˜¢");
      } finally {
        // ë²„íŠ¼ ë³µì›
        shareBtn.disabled = false;
        shareBtnText.textContent = canShare ? "ğŸ“¤ ê³µìœ í•˜ê¸°" : "ğŸ“¸ ì €ì¥í•˜ê¸°";
      }
    }

    resetBtn.addEventListener("click", resetCards);
    shareBtn.addEventListener("click", shareOrSave);

    cardSpread.addEventListener("click", (e) => {
      if (e.target === cardSpread && selectedCard) {
        selectedCard.classList.remove("selected", "flipped");
        cards.forEach(c => c.classList.remove("hidden"));
        selectedCard = null;
        isFlipped = false;
        hint.textContent = "ì¹´ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”";
        btnGroup.classList.remove("visible");
      }
    });

    createCards();
  </script>
</body>
</html>